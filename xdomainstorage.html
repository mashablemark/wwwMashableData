<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" href="/global/styles/prettify.css" type="text/css" />
<link rel="stylesheet" href="/global/styles/screen.css" type="text/css" />
<link rel="stylesheet" href="/global/styles/global.css" type="text/css" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Local Storage inventory</title>
</head>
<body>

</body>
 <div id="header">
    <a href="/"><h1><img src="/images/md_logo.png" /></h1>
    <h4 style="color:#CCCCCC">Sharing data and visualizatons across the web</h4></a>
  </div>
<h3 id="pid">Local Storage inventory</h3>
<div id="ls">sdfgsdf</div>
<button id="clear_ls" onclick="{clear_ls();readLocalStorage()}">Clear Local Storage</button> <button id="xwrite" onclick="xwrite();">Cross Domain Write</button><br /><br />
<div id="dmd"></div>
<div id="wrapper">
  <div id="content">
<script language="javascript">
var now = new Date();
window.localStorage.setItem(now.toString(), location.href);
document.getElementById("pid").innerHTML += " " + location.href.split("/")[2];

function readLocalStorage(){
	var output = "";
	for(var i=0;i<window.localStorage.length;i++){
		output = output + "<strong>" +  window.localStorage.key(i) + "</strong>: " +  window.localStorage.getItem(window.localStorage.key(i)) + "<br />";
	}
	document.getElementById("ls").innerHTML = output;
	
}
readLocalStorage();

if(location.href.indexOf("mashabledata.com") != "-1"){
	document.getElementById("dmd").innerHTML = '<iframe id="wmd" width="600px" height="400px" contentWindow="wmd" src="http://mashabledata.net/xdomainstorage.html"></iframe>'
} else {
	document.getElementById("xwrite").disabled = "disabled";
}
 
function clear_ls(){
	window.localStorage.clear()	
}
function xwrite(){
	var otherWindow = window.frames[0];
	otherWindow.postMessage("message from " + location.href,  "*");
}

if (window.addEventListener){  
  window.addEventListener('message', receiveMessage, false);   
} else if (window.attachEvent){ 
   window.attachEvent('message', receiveMessage);  
} 
//window.addEventListener("message", receiveMessage, false);  

function receiveMessage(event) {  
  now = new Date();
	//alert(event);
  window.localStorage.setItem(now.toString(), event.data); 
  readLocalStorage();
	//console.info(event.origin);
} 
</script>

<div id="footer">
<p>all rights reserved</p>
</div>
</html>
